<!-- 스터디 호스트 관리 뷰 -->
{% if study.is_closed %}
<div class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
  <div class="flex items-center space-x-2 mb-2">
    <span
      class="bg-red-100 text-red-800 text-xs font-medium px-2 py-1 rounded-full"
    >
      마감
    </span>
    <h3 class="font-semibold text-gray-900">스터디가 확정되었습니다</h3>
  </div>
  {% if study.study_date %}
  <p class="text-sm text-gray-600">
    확정된 일정:
    <span class="font-medium">{{ to_datetime_str(study.study_date) }}</span>
  </p>
  {% endif %}
</div>
{% else %}
<!-- 날짜 선택 섹션 -->
<div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
  <h3 class="font-semibold text-gray-900 mb-3">스터디 진행 날짜 선택 (필수)</h3>
  <div class="space-y-2">
    {% for candidate_date in study.candidate %}
    <label class="flex items-center space-x-2 cursor-pointer">
      <input
        type="radio"
        name="study_date"
        value="{{ candidate_date.date }}"
        class="form-radio text-indigo-600"
        required
      />
      <span class="text-sm text-gray-700"
        >{{ to_datetime_str(candidate_date.date) }}</span
      >
    </label>
    {% endfor %}
  </div>
</div>
{% endif %}

<div class="grid grid-cols-2 gap-6 h-96">
  <!-- 좌측: 확정된 참가자 -->
  <div class="border rounded-lg p-4">
    <h3 class="font-semibold text-gray-900 mb-3 text-center">확정 참가자</h3>
    <div class="text-center text-gray-500 text-sm mb-2">
      <span id="confirmed-count">{{ confirmed_participants|length }}</span>/{{
      study.max_participants }}
    </div>
    <div id="confirmed-list" class="space-y-2 overflow-y-auto max-h-64">
      {% for participant in confirmed_participants %}
      <div
        class="flex items-center justify-between p-2 bg-gray-50 rounded"
        data-user-id="{{ participant.id }}"
      >
        <span class="text-sm">{{ participant.name }}</span>
        <div class="flex space-x-2">
          <button
            type="button"
            onclick="showUserProfile('{{ participant.id }}')"
            class="text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"
          >
            소개
          </button>
          {% if not study.is_closed %}
          <button
            type="button"
            onclick="removeFromConfirmed('{{ participant.id }}')"
            class="text-xs px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600"
          >
            제거
          </button>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- 우측: 지원자 목록 -->
  <div class="border rounded-lg p-4">
    <h3 class="font-semibold text-gray-900 mb-3 text-center">지원자 목록</h3>
    <div id="candidate-list" class="space-y-2 overflow-y-auto max-h-64">
      {% for candidate in pending_candidates %}
      <div
        class="flex items-center justify-between p-2 bg-gray-50 rounded"
        data-user-id="{{ candidate.id }}"
      >
        <span class="text-sm">{{ candidate.name }}</span>
        <div class="flex space-x-2">
          <button
            type="button"
            onclick="showUserProfile('{{ candidate.id }}')"
            class="text-xs px-2 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"
          >
            소개
          </button>
          {% if not study.is_closed %}
          <button
            type="button"
            onclick="addToConfirmed('{{ candidate.id }}')"
            class="text-xs px-2 py-1 bg-green-500 text-white rounded hover:bg-green-600"
          >
            승인
          </button>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- 액션 버튼들 -->
<div class="mt-6 flex justify-center space-x-4">
  {% if study.is_closed %}
  <div class="text-gray-500 text-sm">스터디가 이미 확정되었습니다.</div>
  {% else %}
  <button
    type="button"
    id="confirm-btn"
    onclick="confirmCandidates('{{ study.id }}')"
    class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg font-medium flex items-center justify-center min-w-[80px]"
  >
    <span id="confirm-btn-text">확정</span>
    <svg
      id="confirm-loading-spinner"
      class="hidden animate-spin ml-2 h-4 w-4 text-white"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
    >
      <circle
        class="opacity-25"
        cx="12"
        cy="12"
        r="10"
        stroke="currentColor"
        stroke-width="4"
      ></circle>
      <path
        class="opacity-75"
        fill="currentColor"
        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
      ></path>
    </svg>
  </button>
  <button
    type="button"
    onclick="deleteStudy('{{ study.id }}')"
    class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-medium"
  >
    스터디 삭제
  </button>
  {% endif %}
</div>

<!-- 로딩 오버레이 -->
<div
  id="confirm-loading-overlay"
  class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
>
  <div class="bg-white rounded-lg p-8 flex flex-col items-center space-y-4">
    <div
      class="animate-spin rounded-full h-12 w-12 border-4 border-indigo-500 border-t-transparent"
    ></div>
    <div class="text-lg font-medium text-gray-900">참가자 확정 중...</div>
    <div class="text-sm text-gray-600">알림과 이메일을 발송하고 있습니다</div>
  </div>
</div>
