{% extends "authenticated_base.html" %} {% block title %}스터디 만들기{%
endblock %} {% block page_content %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-8">
  <form id="createStudyForm" class="space-y-6">
    <label for="studyName" class="block text-sm font-medium text-gray-700 mb-2"
      >스터디 이름</label
    >
    <input
      id="studyName"
      name="studyName"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 text-gray-900 placeholder-gray-500"
      type="text"
      placeholder="스터디 이름을 입력해주세요."
      required
    />

    <label for="studyInfo" class="block text-sm font-medium text-gray-700 mb-2"
      >스터디 소개</label
    >
    <textarea
      id="studyIntro"
      name="studyIntro"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 text-gray-900 placeholder-gray-500 resize-y"
      placeholder="스터디 소개를 입력해주세요."
    ></textarea>

    <label
      for="maxParticipants"
      class="block text-sm font-medium text-gray-700 mb-2"
      >모집 인원</label
    >
    <input
      id="maxParticipants"
      name="maxParticipants"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 text-gray-900 placeholder-gray-500"
      type="number"
    />
    <label for="category" class="block text-sm font-medium text-gray-700 mb-2"
      >관심사 카테고리</label
    >

    <select
      id="category"
      name="category"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 text-gray-900 bg-white appearance-none cursor-pointer"
      style="
        background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iOCIgdmlld0JveD0iMCAwIDEyIDgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik0xIDFMNiA2TDExIDEiIHN0cm9rZT0iIzZCNzI4MCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9zdmc+');
        background-position: right 12px center;
        background-repeat: no-repeat;
        background-size: 12px;
      "
    >
      <option value="">선택하세요</option>
      <option value="al">알고리즘</option>
      <option value="cl">C언어</option>
      <option value="ds">자료구조</option>
      <option value="po">PintOS</option>
      <option value="ws">웹서버</option>
      <option value="ms">메모리 구조</option>
      <option value="nw">네트워크</option>
      <option value="py">파이썬</option>
      <option value="cs">CS</option>
    </select>
    <br />

    <label
      for="expectedDate"
      class="block text-sm font-medium text-gray-700 mb-2"
      >예상 모임 날짜</label
    >
    <input
      id="expectedDate"
      name="expectedDate"
      type="datetime-local"
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 text-gray-900"
    />
    <br />

    <div id="expectedDateList">
      <ul></ul>
    </div>

    <button
      type="submit"
      class="w-full bg-gray-800 text-white py-2 px-4 rounded-md hover:bg-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition-colors"
    >
      생성
    </button>
  </form>
</div>
{% endblock %} {% block scripts %}
<script>
  let expectedDateList = [];
  let counter = 0;

  (function () {
    $("#createStudyForm").on("submit", function (e) {
      e.preventDefault();
      const data = {
        studyName: $(studyName).val(),
        studyIntro: $(studyIntro).val(),
        maxParticipants: $(maxParticipants).val(),
        category: $(category).val(),
        expectedDateList: expectedDateList,
      };

      $.ajax({
        type: "POST",
        url: "/study/create",
        contentType: "application/json",
        data: JSON.stringify(data),
        success: function (response) {
          if (response.result === "success") {
            alert("스터디 생성이 완료되었습니다.");
            window.location.href = "/study?tab=my";
          } else if (response.result === "error") {
            alert(response.message || "스터디 생성에 실패했습니다.");
          }
        },
        error: function (xhr, status, error) {
          let errorMessage = "스터디 생성 중 오류가 발생했습니다.";
          if (xhr.responseJSON && xhr.responseJSON.message) {
            errorMessage = xhr.responseJSON.message;
          }
          alert(errorMessage);
        },
      });
    });

    $("#expectedDate").on("change", function () {
      const selectedDate = $(this).val();

      if (
        $("#expectedDateList").find(`li[data-date='${selectedDate}']`)
          .length === 0
      ) {
        counter++;
        const uniqueId = "date_" + counter;

        expectedDateList.push({
          uniqueId,
          selectedDate,
        });

        $("#expectedDateList ul").append(
          `<li id="${uniqueId}" data-date="${selectedDate}">
                        ${selectedDate} <button class="remove-btn" style="margin-left:8px;">[x]</button>
                    </li>`
        );
      }
    });

    // 삭제 버튼 클릭 시: 해당 li의 id 삭제
    $("#expectedDateList").on("click", ".remove-btn", function () {
      const li = $(this).closest("li");
      delId = li.attr("id");
      // UI 삭제
      li.remove();

      // 실제 Data삭제
      expectedDateList = expectedDateList.filter(
        (item) => item.uniqueId !== delId
      );
    });
  })();
</script>
{% endblock %}

<!-- TODO: 지나간 날짜와 시간은 선택 불가 -->
